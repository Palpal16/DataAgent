╔════════════════════════════════════════════════════════════════════════════╗
║                 AGENT CONFIG RUNNER - COMPLETE WORKFLOW                    ║
╚════════════════════════════════════════════════════════════════════════════╝

┌──────────────────────────────────────────────────────────────────────────┐
│                          INPUT: agent_config.yaml                        │
└──────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
                    ┌───────────────────────────────┐
                    │  agent_config_runner          │
                    │  (Enhanced C++ binary)        │
                    └───────────────────────────────┘
                                    │
                    ┌───────────────┴───────────────┐
                    │  Check: use_jmeter flag       │
                    └───────────────┬───────────────┘
                                    │
                ┌───────────────────┴───────────────────┐
                │                                       │
              false                                   true
                │                                       │
                ▼                                       ▼
    ┌───────────────────────┐           ┌───────────────────────────┐
    │ DIRECT PYTHON MODE    │           │     JMETER MODE           │
    └───────────────────────┘           └───────────────────────────┘
                │                                       │
                |                                       ▼
                |                        ┌───────────────────────────┐
                |                        |    Run agent_api.py       |
                |                        └───────────────────────────┘
                |                                       |
                │                       ┌───────────────┴───────────────┐
                │                       │  Check: run_batch flag        │
                │                       └───────────────┬───────────────┘
                │                                       │
                │                       ┌───────────────┴───────────────┐
                │                       │                               │
                │                     false                           true
                │                       │                               │
                ▼                       ▼                               ▼
    ┌───────────────────────┐   ┌─────────────────┐    ┌────────────────────┐
    │ Check: run_batch      │   │ Load template:  │    │ Load template:     │
    └───────────────────────┘   │ single_test.jmx │    │ batch_test.jmx     │
                │               └─────────────────┘    └────────────────────┘
    ┌───────────┴───────────┐            │                       │
  false                   true           │                       │
    ▼                       ▼            │                       │
┌────────────┐   ┌──────────────────┐    │                       │
│ Single     │   │ Batch Processing │    ▼                       ▼
│ Query      │   │                  │  ┌─────────────────────────────────┐
│            │   │ For each test:   │  │ Modify JMX variables:           │
│ python -m  │   │ 1. Create temp   │  │ - api_host, api_port            │
│ Agent.     │   │    gt files      │  │ - model, best_of_n, temp        │
│ data_agent │   │ 2. Build command │  │ - test_cases_json               │
│ <args>     │   │ 3. Execute       │  └─────────────────────────────────┘
│            │   │ 4. Cleanup       │                  │
└────────────┘   └──────────────────┘                  ▼
    │                       │            ┌───────────────────────────────────┐
    │                       │            │ Save to: /tmp/agent_test_XXX.jmx  │
    │                       │            └───────────────────────────────────┘
    │                       │                            │
    │                       │                            ▼
    │                       │            ┌───────────────────────────────────┐
    │                       │            │ Execute JMeter:                   │
    │                       │            │ jmeter -n -t temp.jmx             │
    │                       │            │   -l results_timestamp.jtl        │
    │                       │            │   -e -o report_timestamp/         │
    │                       │            └───────────────────────────────────┘
    │                       │                            │
    │                       │                            ▼
    │                       │            ┌───────────────────────────────────┐
    │                       │            │ JMeter calls API:                 │
    │                       │            │ POST http://localhost:5001/       │
    │                       │            │      /call-agent                  │
    │                       │            └───────────────────────────────────┘
    │                       │                            │
    │                       │                            ▼
    │                       │            ┌───────────────────────────────────┐
    │                       │            │ API runs: data_agent.py           │
    │                       │            └───────────────────────────────────┘
    │                       │                            │
    ▼                       ▼                            ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                              OUTPUTS                                    │
└─────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────┐  ┌──────────────────────────────────────────┐
│ DIRECT PYTHON OUTPUT:    │  │ JMETER OUTPUT:                           │
│                          │  │                                          │
│ save_dir/                │  │ jmeter_results/                          │
│ ├── result.csv           │  │ ├── results_20250127_184530.jtl (CSV)    │
│ ├── analysis.txt         │  │ └── report_20250127_184530/              │
│ └── all_results.json     │  │     ├── index.html (Dashboard)           │
│                          │  │     ├── content/                         │
│ (Batch mode adds:)       │  │     │   ├── js/                          │
│ ├── test_1/              │  │     │   └── pages/                       │
│ ├── test_2/              │  │     └── sbadmin2-*/                      │
│ └── test_N/              │  │                                          │
└──────────────────────────┘  └──────────────────────────────────────────┘